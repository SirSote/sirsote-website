<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Project | SirSote Echo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --accent: #00ff88;
            --accent-dim: #00ff8833;
            --danger: #ff3366;
            --border: #2a2a2a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Matrix background effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.15;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 255, 136, 0.03) 2px, rgba(0, 255, 136, 0.03) 4px);
            z-index: 1000;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 100;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: '>';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            padding: 6rem 1.5rem 2rem;
        }

        /* Messages Area */
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.bot {
            align-self: flex-start;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
        }

        .message.user {
            align-self: flex-end;
            background: var(--accent);
            color: var(--bg-primary);
        }

        .message .sender {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            opacity: 0.7;
        }

        .message.bot .sender {
            color: var(--accent);
        }

        .message .content {
            font-size: 1rem;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 0.5rem 0;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            padding: 1rem 0;
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            resize: none;
            min-height: 52px;
            max-height: 150px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        .send-btn {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .send-btn:hover {
            box-shadow: 0 0 20px var(--accent-dim);
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .option-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.875rem 1rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option-btn:hover {
            border-color: var(--accent);
            background: var(--accent-dim);
            color: var(--accent);
        }

        /* Progress Indicator */
        .progress-bar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--border);
            z-index: 99;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #00cc6a);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--accent);
        }

        /* Success Screen */
        .success-screen {
            text-align: center;
            padding: 3rem 1rem;
            animation: fadeIn 0.5s ease;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .success-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.75rem;
            color: var(--accent);
            margin-bottom: 1rem;
            text-shadow: 0 0 20px var(--accent-dim);
        }

        .success-message {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .success-btn {
            display: inline-block;
            padding: 1rem 2rem;
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .success-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            box-shadow: 0 0 30px var(--accent-dim);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .chat-container {
                padding: 5rem 1rem 1rem;
            }

            .message {
                max-width: 90%;
            }

            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="matrix-bg"><canvas id="matrix"></canvas></div>

    <nav>
        <a href="index.html" class="logo">SirSote</a>
        <a href="index.html" class="nav-link">Back to Home</a>
    </nav>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>

    <div class="chat-container">
        <div class="messages" id="messages"></div>

        <div class="input-area" id="inputArea">
            <div class="input-wrapper">
                <textarea
                    class="input-field"
                    id="userInput"
                    placeholder="Type your response..."
                    rows="1"
                ></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // N8N WEBHOOK CONFIG
        // =============================================================================
        const N8N_WEBHOOK_URL = 'https://n8n.sirsote.com/webhook/intake';

        // =============================================================================
        // CHAT STATE
        // =============================================================================
        const questions = [
            {
                id: 'intro',
                bot: "Hey! I'm Echo, SirSote's project assistant. I'll help you get started with your project in just a few questions.",
                followUp: "First things first — what's your name?",
                field: 'name',
                type: 'text'
            },
            {
                id: 'company',
                bot: (data) => `Nice to meet you, ${data.name}! What's your company or organization called? (Type "none" if it's a personal project)`,
                field: 'company',
                type: 'text'
            },
            {
                id: 'email',
                bot: "What's the best email to reach you at?",
                field: 'email',
                type: 'email'
            },
            {
                id: 'project_type',
                bot: "What type of project are you looking for?",
                field: 'project_type',
                type: 'options',
                options: ['Website', 'AI Chatbot', 'Automation', 'Consulting', 'Other']
            },
            {
                id: 'budget',
                bot: "What's your budget range for this project?",
                field: 'budget',
                type: 'options',
                options: ['< $1,000', '$1K - $5K', '$5K - $10K', '$10K+', 'Not sure']
            },
            {
                id: 'timeline',
                bot: "When do you need this completed?",
                field: 'timeline',
                type: 'options',
                options: ['ASAP', '1-2 weeks', '1 month', '2-3 months', 'Flexible']
            },
            {
                id: 'description',
                bot: "Tell me a bit about your project. What are you trying to build or solve?",
                field: 'description',
                type: 'textarea'
            }
        ];

        let currentStep = 0;
        let userData = {};
        let isProcessing = false;

        // =============================================================================
        // DOM ELEMENTS
        // =============================================================================
        const messagesEl = document.getElementById('messages');
        const inputArea = document.getElementById('inputArea');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const progressFill = document.getElementById('progressFill');

        // =============================================================================
        // CHAT FUNCTIONS
        // =============================================================================
        function addMessage(content, isUser = false, options = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

            let html = '';
            if (!isUser) {
                html += '<div class="sender">Echo</div>';
            }
            html += `<div class="content">${content}</div>`;

            if (options) {
                html += '<div class="options-grid">';
                options.forEach(opt => {
                    html += `<button class="option-btn" onclick="selectOption('${opt}')">${opt}</button>`;
                });
                html += '</div>';
            }

            messageDiv.innerHTML = html;
            messagesEl.appendChild(messageDiv);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `
                <div class="sender">Echo</div>
                <div class="typing-indicator">
                    <span></span><span></span><span></span>
                </div>
            `;
            messagesEl.appendChild(typingDiv);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }

        function updateProgress() {
            const progress = ((currentStep + 1) / questions.length) * 100;
            progressFill.style.width = `${progress}%`;
        }

        async function askQuestion() {
            if (currentStep >= questions.length) {
                await submitData();
                return;
            }

            const q = questions[currentStep];
            showTyping();

            await delay(800);
            hideTyping();

            let botText = typeof q.bot === 'function' ? q.bot(userData) : q.bot;
            addMessage(botText, false, q.type === 'options' ? q.options : null);

            if (q.followUp) {
                showTyping();
                await delay(600);
                hideTyping();
                addMessage(q.followUp);
            }

            // Hide text input for option questions
            if (q.type === 'options') {
                inputArea.style.display = 'none';
            } else {
                inputArea.style.display = 'block';
                userInput.focus();
                userInput.placeholder = q.type === 'email' ? 'your@email.com' :
                                        q.type === 'textarea' ? 'Describe your project...' :
                                        'Type your response...';
            }

            updateProgress();
        }

        function selectOption(option) {
            if (isProcessing) return;
            isProcessing = true;

            const q = questions[currentStep];
            userData[q.field] = option;

            addMessage(option, true);
            inputArea.style.display = 'block';

            currentStep++;
            isProcessing = false;
            askQuestion();
        }

        async function sendMessage() {
            const value = userInput.value.trim();
            if (!value || isProcessing) return;

            isProcessing = true;
            sendBtn.disabled = true;

            const q = questions[currentStep];

            // Validate email
            if (q.type === 'email' && !isValidEmail(value)) {
                addMessage(value, true);
                showTyping();
                await delay(500);
                hideTyping();
                addMessage("Hmm, that doesn't look like a valid email. Try again?");
                userInput.value = '';
                isProcessing = false;
                sendBtn.disabled = false;
                return;
            }

            userData[q.field] = value;
            addMessage(value, true);
            userInput.value = '';

            currentStep++;
            isProcessing = false;
            sendBtn.disabled = false;

            askQuestion();
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // =============================================================================
        // N8N WEBHOOK SUBMISSION
        // =============================================================================
        async function submitData() {
            showTyping();
            await delay(1000);
            hideTyping();
            addMessage("Perfect! Let me save your project details...");

            showTyping();

            try {
                // Send intake data to n8n webhook
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: userData.name,
                        email: userData.email,
                        company: userData.company === 'none' ? null : userData.company,
                        project_type: userData.project_type,
                        budget: userData.budget,
                        timeline: userData.timeline,
                        description: userData.description,
                        submitted_at: new Date().toISOString(),
                        source: 'start.html'
                    })
                });

                if (!response.ok) {
                    const err = await response.text();
                    throw new Error(err || 'Failed to submit intake');
                }

                hideTyping();
                showSuccess();

            } catch (error) {
                console.error('Submission error:', error);
                hideTyping();
                addMessage(`There was an issue saving your project: ${error.message}. Please email git@sirsote.com directly.`);
            }
        }

        function showSuccess() {
            messagesEl.innerHTML = '';
            inputArea.style.display = 'none';
            progressFill.style.width = '100%';

            const successDiv = document.createElement('div');
            successDiv.className = 'success-screen';
            successDiv.innerHTML = `
                <div class="success-icon">✓</div>
                <h2 class="success-title">Project Submitted!</h2>
                <p class="success-message">
                    Thanks, ${userData.name}! I've logged your ${userData.project_type.toLowerCase()} project.<br>
                    SirSote will reach out to <strong>${userData.email}</strong> within 24 hours.
                </p>
                <a href="index.html" class="success-btn">Back to Home</a>
            `;
            messagesEl.appendChild(successDiv);
        }

        // =============================================================================
        // INPUT HANDLING
        // =============================================================================
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
        });

        // =============================================================================
        // MATRIX BACKGROUND
        // =============================================================================
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const chars = '01';
        const charArray = chars.split('');
        const fontSize = 14;
        let columns = canvas.width / fontSize;
        let drops = [];

        for (let i = 0; i < columns; i++) {
            drops[i] = 1;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00ff88';
            ctx.font = fontSize + 'px JetBrains Mono';

            for (let i = 0; i < drops.length; i++) {
                const text = charArray[Math.floor(Math.random() * charArray.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 35);

        // =============================================================================
        // INIT
        // =============================================================================
        window.onload = () => {
            askQuestion();
        };
    </script>
</body>
</html>
