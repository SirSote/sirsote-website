<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Project | SirSote Echo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-card: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --accent: #00ff88;
            --accent-dim: #00ff8833;
            --danger: #ff3366;
            --border: #2a2a2a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Matrix background effect */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.15;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 255, 136, 0.03) 2px, rgba(0, 255, 136, 0.03) 4px);
            z-index: 1000;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 100;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: '>';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            padding: 6rem 1.5rem 2rem;
        }

        /* Messages Area */
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.bot {
            align-self: flex-start;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
        }

        .message.user {
            align-self: flex-end;
            background: var(--accent);
            color: var(--bg-primary);
        }

        .message .sender {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            opacity: 0.7;
        }

        .message.bot .sender {
            color: var(--accent);
        }

        .message .content {
            font-size: 1rem;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 0.5rem 0;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        /* Input Area */
        .input-area {
            padding: 1rem 0;
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            resize: none;
            min-height: 52px;
            max-height: 150px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        .send-btn {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .send-btn:hover {
            box-shadow: 0 0 20px var(--accent-dim);
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .option-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.875rem 1rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .option-btn:hover {
            border-color: var(--accent);
            background: var(--accent-dim);
            color: var(--accent);
        }

        /* Progress Indicator */
        .progress-bar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--border);
            z-index: 99;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #00cc6a);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--accent);
        }

        /* Success Screen */
        .success-screen {
            text-align: center;
            padding: 3rem 1rem;
            animation: fadeIn 0.5s ease;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .success-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.75rem;
            color: var(--accent);
            margin-bottom: 1rem;
            text-shadow: 0 0 20px var(--accent-dim);
        }

        .success-message {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .success-btn {
            display: inline-block;
            padding: 1rem 2rem;
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .success-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            box-shadow: 0 0 30px var(--accent-dim);
        }

        /* Expandable Categories */
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 1rem;
            width: 100%;
        }

        .category-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .category-card.expanded {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent-dim);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .category-header:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .category-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--accent);
            flex-shrink: 0;
        }

        .category-icon {
            width: 28px;
            height: 28px;
            background: var(--accent-dim);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .category-info {
            flex: 1;
            min-width: 0;
        }

        .category-label {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 1px;
        }

        .category-description {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .category-expand {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: transform 0.2s;
            flex-shrink: 0;
            font-size: 12px;
        }

        .category-card.expanded .category-expand {
            transform: rotate(180deg);
        }

        .category-options {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: var(--bg-card);
        }

        .category-card.expanded .category-options {
            max-height: 800px;
        }

        .category-options-inner {
            padding: 0 14px 14px;
        }

        .option-group {
            margin-bottom: 12px;
        }

        .option-group:last-child {
            margin-bottom: 0;
        }

        .option-group-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent);
            margin-bottom: 6px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .option-group:first-child .option-group-label {
            border-top: none;
            padding-top: 0;
        }

        .option-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: border-color 0.2s, background 0.2s;
        }

        .option-item:hover {
            border-color: var(--accent);
        }

        .option-item.selected {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .option-item input {
            width: 14px;
            height: 14px;
            accent-color: var(--accent);
        }

        .category-count {
            font-size: 10px;
            padding: 2px 6px;
            background: var(--accent);
            color: var(--bg-primary);
            border-radius: 8px;
            font-weight: 600;
            margin-left: auto;
            display: none;
        }

        .category-card.has-selections .category-count {
            display: inline-block;
        }

        .integrations-continue {
            margin-top: 1rem;
            padding: 0.875rem 1.5rem;
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
        }

        .integrations-continue:hover {
            box-shadow: 0 0 20px var(--accent-dim);
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .chat-container {
                padding: 5rem 1rem 1rem;
            }

            .message {
                max-width: 90%;
            }

            .options-grid {
                grid-template-columns: 1fr 1fr;
            }

            .category-header {
                padding: 10px 12px;
            }

            .option-list {
                gap: 4px;
            }

            .option-item {
                padding: 5px 8px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="matrix-bg"><canvas id="matrix"></canvas></div>

    <nav>
        <a href="index.html" class="logo">SirSote</a>
        <a href="index.html" class="nav-link">Back to Home</a>
    </nav>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>

    <div class="chat-container">
        <div class="messages" id="messages"></div>

        <div class="input-area" id="inputArea">
            <div class="input-wrapper">
                <textarea
                    class="input-field"
                    id="userInput"
                    placeholder="Type your response..."
                    rows="1"
                ></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // N8N WEBHOOK CONFIG
        // =============================================================================
        const N8N_WEBHOOK_URL = 'https://sirsote.com/api/echo';

        // =============================================================================
        // CHAT STATE
        // =============================================================================
        const questions = [
            {
                id: 'intro',
                bot: "Hey! I'm Echo, SirSote's project assistant. I'll help you get started with your project in just a few questions.",
                followUp: "First things first â€” what's your name?",
                field: 'name',
                type: 'text'
            },
            {
                id: 'company',
                bot: (data) => `Nice to meet you, ${data.name}! What's your company or organization called? (Type "none" if it's a personal project)`,
                field: 'company',
                type: 'text'
            },
            {
                id: 'email',
                bot: "What's the best email to reach you at?",
                field: 'email',
                type: 'email'
            },
            {
                id: 'project_type',
                bot: "What type of project are you looking for?",
                field: 'project_type',
                type: 'options',
                options: ['Website', 'AI Chatbot', 'Automation', 'Consulting', 'Other']
            },
            {
                id: 'budget',
                bot: "What's your budget range for this project?",
                field: 'budget',
                type: 'options',
                options: ['< $1,000', '$1K - $5K', '$5K - $10K', '$10K+', 'Not sure']
            },
            {
                id: 'timeline',
                bot: "When do you need this completed?",
                field: 'timeline',
                type: 'options',
                options: ['ASAP', '1-2 weeks', '1 month', '2-3 months', 'Flexible']
            },
            {
                id: 'description',
                bot: "Tell me a bit about your project. What are you trying to build or solve?",
                field: 'description',
                type: 'textarea'
            },
            {
                id: 'integrations',
                bot: "What systems or tools do you need to integrate? Select any categories that apply, then pick specific options.",
                field: 'integrations',
                type: 'integrations'
            }
        ];

        let currentStep = 0;
        let userData = {};
        let isProcessing = false;

        // =============================================================================
        // DOM ELEMENTS
        // =============================================================================
        const messagesEl = document.getElementById('messages');
        const inputArea = document.getElementById('inputArea');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const progressFill = document.getElementById('progressFill');

        // =============================================================================
        // CHAT FUNCTIONS
        // =============================================================================
        function addMessage(content, isUser = false, options = null, type = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;

            let html = '';
            if (!isUser) {
                html += '<div class="sender">Echo</div>';
            }
            html += `<div class="content">${content}</div>`;

            if (options) {
                html += '<div class="options-grid">';
                options.forEach(opt => {
                    html += `<button class="option-btn" onclick="selectOption('${opt}')">${opt}</button>`;
                });
                html += '</div>';
            }

            if (type === 'integrations') {
                html += getIntegrationsHTML();
            }

            messageDiv.innerHTML = html;
            messagesEl.appendChild(messageDiv);
            messagesEl.scrollTop = messagesEl.scrollHeight;

            if (type === 'integrations') {
                setupExpandableCategories();
            }
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `
                <div class="sender">Echo</div>
                <div class="typing-indicator">
                    <span></span><span></span><span></span>
                </div>
            `;
            messagesEl.appendChild(typingDiv);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }

        function updateProgress() {
            const progress = ((currentStep + 1) / questions.length) * 100;
            progressFill.style.width = `${progress}%`;
        }

        async function askQuestion() {
            if (currentStep >= questions.length) {
                await submitData();
                return;
            }

            const q = questions[currentStep];
            showTyping();

            await delay(800);
            hideTyping();

            let botText = typeof q.bot === 'function' ? q.bot(userData) : q.bot;
            addMessage(botText, false, q.type === 'options' ? q.options : null, q.type);

            if (q.followUp) {
                showTyping();
                await delay(600);
                hideTyping();
                addMessage(q.followUp);
            }

            // Hide text input for option and integration questions
            if (q.type === 'options' || q.type === 'integrations') {
                inputArea.style.display = 'none';
            } else {
                inputArea.style.display = 'block';
                userInput.focus();
                userInput.placeholder = q.type === 'email' ? 'your@email.com' :
                                        q.type === 'textarea' ? 'Describe your project...' :
                                        'Type your response...';
            }

            updateProgress();
        }

        function selectOption(option) {
            if (isProcessing) return;
            isProcessing = true;

            const q = questions[currentStep];
            userData[q.field] = option;

            addMessage(option, true);
            inputArea.style.display = 'block';

            currentStep++;
            isProcessing = false;
            askQuestion();
        }

        async function sendMessage() {
            const value = userInput.value.trim();
            if (!value || isProcessing) return;

            isProcessing = true;
            sendBtn.disabled = true;

            const q = questions[currentStep];

            // Validate email
            if (q.type === 'email' && !isValidEmail(value)) {
                addMessage(value, true);
                showTyping();
                await delay(500);
                hideTyping();
                addMessage("Hmm, that doesn't look like a valid email. Try again?");
                userInput.value = '';
                isProcessing = false;
                sendBtn.disabled = false;
                return;
            }

            userData[q.field] = value;
            addMessage(value, true);
            userInput.value = '';

            currentStep++;
            isProcessing = false;
            sendBtn.disabled = false;

            askQuestion();
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // =============================================================================
        // EXPANDABLE INTEGRATIONS
        // =============================================================================
        function getIntegrationsHTML() {
            return `
            <div class="category-list" id="integrationCategories">
                <!-- Core Business Systems -->
                <div class="category-card" data-category="core">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <input type="checkbox" class="category-checkbox" data-cat="core" onclick="event.stopPropagation(); toggleCategory(this.parentElement)">
                        <div class="category-icon">&#128188;</div>
                        <div class="category-info">
                            <div class="category-label">Core Business</div>
                            <div class="category-description">CRM, email, productivity</div>
                        </div>
                        <span class="category-count">0</span>
                        <div class="category-expand">&#9660;</div>
                    </div>
                    <div class="category-options">
                        <div class="category-options-inner">
                            <div class="option-group">
                                <div class="option-group-label">CRM</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="salesforce"><span>Salesforce</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="hubspot"><span>HubSpot</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="pipedrive"><span>Pipedrive</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Email & Calendar</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="gmail"><span>Gmail / Google</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="outlook"><span>Outlook / M365</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="calendar"><span>Calendar</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Communication</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="slack"><span>Slack</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="teams"><span>Teams</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Data & Commerce</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="sheets"><span>Google Sheets</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="airtable"><span>Airtable</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="shopify"><span>Shopify</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="core" value="stripe"><span>Stripe</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI & Intelligent Systems -->
                <div class="category-card" data-category="ai">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <input type="checkbox" class="category-checkbox" data-cat="ai" onclick="event.stopPropagation(); toggleCategory(this.parentElement)">
                        <div class="category-icon">&#129504;</div>
                        <div class="category-info">
                            <div class="category-label">AI & Automation</div>
                            <div class="category-description">Chatbots, RAG, workflows</div>
                        </div>
                        <span class="category-count">0</span>
                        <div class="category-expand">&#9660;</div>
                    </div>
                    <div class="category-options">
                        <div class="category-options-inner">
                            <div class="option-group">
                                <div class="option-group-label">AI Chatbots</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="chatbot_internal"><span>Internal (Team)</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="chatbot_customer"><span>Customer-Facing</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="chatbot_support"><span>Support Triage</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Knowledge & Content</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="rag"><span>Knowledge Base / RAG</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="content_gen"><span>Content Generation</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="seo_ai"><span>AI SEO</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Automation</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="workflow_auto"><span>Workflow Automation</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="data_analysis"><span>Data Analysis</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="ai" value="custom_llm"><span>Custom LLM / Agent</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security & Compliance -->
                <div class="category-card" data-category="security">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <input type="checkbox" class="category-checkbox" data-cat="security" onclick="event.stopPropagation(); toggleCategory(this.parentElement)">
                        <div class="category-icon">&#128737;</div>
                        <div class="category-info">
                            <div class="category-label">Security & Compliance</div>
                            <div class="category-description">Monitoring, protection, regulatory</div>
                        </div>
                        <span class="category-count">0</span>
                        <div class="category-expand">&#9660;</div>
                    </div>
                    <div class="category-options">
                        <div class="category-options-inner">
                            <div class="option-group">
                                <div class="option-group-label">Security Operations</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="monitoring"><span>Monitoring & Alerts</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="vuln_scan"><span>Vulnerability Scanning</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="siem"><span>SIEM / Logs</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Compliance</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="soc2"><span>SOC 2</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="hipaa"><span>HIPAA</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="gdpr"><span>GDPR</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="security" value="pci"><span>PCI-DSS</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Growth & Marketing -->
                <div class="category-card" data-category="growth">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <input type="checkbox" class="category-checkbox" data-cat="growth" onclick="event.stopPropagation(); toggleCategory(this.parentElement)">
                        <div class="category-icon">&#128200;</div>
                        <div class="category-info">
                            <div class="category-label">Growth & Marketing</div>
                            <div class="category-description">Analytics, ads, SEO</div>
                        </div>
                        <span class="category-count">0</span>
                        <div class="category-expand">&#9660;</div>
                    </div>
                    <div class="category-options">
                        <div class="category-options-inner">
                            <div class="option-group">
                                <div class="option-group-label">Analytics</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="google_analytics"><span>Google Analytics</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="mixpanel"><span>Mixpanel</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="heatmaps"><span>Heatmaps</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Advertising</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="google_ads"><span>Google Ads</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="meta_ads"><span>Meta Ads</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="linkedin_ads"><span>LinkedIn Ads</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Outreach</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="email_marketing"><span>Email Marketing</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="growth" value="social_mgmt"><span>Social Media</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Infrastructure & DevOps -->
                <div class="category-card" data-category="infrastructure">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <input type="checkbox" class="category-checkbox" data-cat="infrastructure" onclick="event.stopPropagation(); toggleCategory(this.parentElement)">
                        <div class="category-icon">&#9881;</div>
                        <div class="category-info">
                            <div class="category-label">Infrastructure</div>
                            <div class="category-description">Cloud, DevOps, containers</div>
                        </div>
                        <span class="category-count">0</span>
                        <div class="category-expand">&#9660;</div>
                    </div>
                    <div class="category-options">
                        <div class="category-options-inner">
                            <div class="option-group">
                                <div class="option-group-label">Cloud</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="infrastructure" value="aws"><span>AWS</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="infrastructure" value="azure"><span>Azure</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="infrastructure" value="gcp"><span>GCP</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">DevOps</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="infrastructure" value="docker"><span>Docker</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="infrastructure" value="kubernetes"><span>Kubernetes</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="infrastructure" value="cicd"><span>CI/CD</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data & Intelligence -->
                <div class="category-card" data-category="data">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <input type="checkbox" class="category-checkbox" data-cat="data" onclick="event.stopPropagation(); toggleCategory(this.parentElement)">
                        <div class="category-icon">&#128202;</div>
                        <div class="category-info">
                            <div class="category-label">Data & BI</div>
                            <div class="category-description">Warehousing, pipelines, dashboards</div>
                        </div>
                        <span class="category-count">0</span>
                        <div class="category-expand">&#9660;</div>
                    </div>
                    <div class="category-options">
                        <div class="category-options-inner">
                            <div class="option-group">
                                <div class="option-group-label">Data Storage</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="data" value="warehouse"><span>Data Warehouse</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="data" value="etl"><span>ETL Pipelines</span></label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-group-label">Visualization</div>
                                <div class="option-list">
                                    <label class="option-item"><input type="checkbox" data-cat="data" value="bi_tools"><span>BI Tools</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="data" value="dashboards"><span>Custom Dashboards</span></label>
                                    <label class="option-item"><input type="checkbox" data-cat="data" value="predictive"><span>Predictive Analytics</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- None / Skip -->
                <div class="category-card" data-category="none">
                    <div class="category-header" onclick="selectNoIntegrations()">
                        <input type="checkbox" class="category-checkbox" data-cat="none" onclick="event.stopPropagation(); selectNoIntegrations()">
                        <div class="category-icon">&#10060;</div>
                        <div class="category-info">
                            <div class="category-label">None / Not Sure</div>
                            <div class="category-description">Skip this step</div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="integrations-continue" onclick="continueFromIntegrations()">Continue</button>
            `;
        }

        function toggleCategory(header) {
            const card = header.closest('.category-card');
            const checkbox = card.querySelector('.category-checkbox');
            const isExpanded = card.classList.contains('expanded');

            // Uncheck "None" if selecting other categories
            const noneCat = document.querySelector('[data-category="none"]');
            if (noneCat && card !== noneCat) {
                noneCat.querySelector('.category-checkbox').checked = false;
            }

            if (isExpanded) {
                card.classList.remove('expanded');
                checkbox.checked = false;
            } else {
                card.classList.add('expanded');
                checkbox.checked = true;
            }
        }

        function selectNoIntegrations() {
            // Uncheck all other categories
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('expanded', 'has-selections');
                card.querySelector('.category-checkbox').checked = false;
                card.querySelectorAll('.option-item input:checked').forEach(opt => {
                    opt.checked = false;
                    opt.closest('.option-item').classList.remove('selected');
                });
                const countEl = card.querySelector('.category-count');
                if (countEl) countEl.textContent = '0';
            });

            // Check "None"
            const noneCard = document.querySelector('[data-category="none"]');
            if (noneCard) {
                noneCard.querySelector('.category-checkbox').checked = true;
            }
        }

        function setupExpandableCategories() {
            document.querySelectorAll('.option-item input').forEach(input => {
                input.addEventListener('change', () => {
                    input.closest('.option-item').classList.toggle('selected', input.checked);
                    updateCategoryCount(input.closest('.category-card'));

                    // Uncheck "None" when selecting options
                    if (input.checked) {
                        const noneCat = document.querySelector('[data-category="none"]');
                        if (noneCat) {
                            noneCat.querySelector('.category-checkbox').checked = false;
                        }
                    }
                });
            });

            document.querySelectorAll('.category-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const card = checkbox.closest('.category-card');
                    if (card.dataset.category === 'none') return;

                    if (checkbox.checked) {
                        card.classList.add('expanded');
                    } else {
                        card.classList.remove('expanded');
                        card.querySelectorAll('.option-item input:checked').forEach(opt => {
                            opt.checked = false;
                            opt.closest('.option-item').classList.remove('selected');
                        });
                        updateCategoryCount(card);
                    }
                });
            });
        }

        function updateCategoryCount(card) {
            const count = card.querySelectorAll('.option-item input:checked').length;
            const countEl = card.querySelector('.category-count');
            if (countEl) {
                countEl.textContent = count;
                if (count > 0) {
                    card.classList.add('has-selections');
                } else {
                    card.classList.remove('has-selections');
                }
            }
        }

        function getSelectedIntegrations() {
            const integrations = {};

            document.querySelectorAll('.category-card').forEach(card => {
                const category = card.dataset.category;
                if (category === 'none') {
                    if (card.querySelector('.category-checkbox').checked) {
                        integrations.none = true;
                    }
                    return;
                }

                const selected = [];
                card.querySelectorAll('.option-item input:checked').forEach(input => {
                    selected.push(input.value);
                });

                if (selected.length > 0) {
                    integrations[category] = selected;
                }
            });

            return integrations;
        }

        function continueFromIntegrations() {
            if (isProcessing) return;
            isProcessing = true;

            const q = questions[currentStep];
            const integrations = getSelectedIntegrations();
            userData[q.field] = integrations;

            // Create summary for display
            let summary = 'None selected';
            if (!integrations.none) {
                const counts = Object.keys(integrations).map(cat => {
                    return `${cat}: ${integrations[cat].length}`;
                });
                if (counts.length > 0) {
                    summary = counts.join(', ');
                }
            }

            addMessage(summary, true);
            inputArea.style.display = 'block';

            currentStep++;
            isProcessing = false;
            askQuestion();
        }

        // =============================================================================
        // N8N WEBHOOK SUBMISSION
        // =============================================================================
        async function submitData() {
            showTyping();
            await delay(1000);
            hideTyping();
            addMessage("Perfect! Let me save your project details...");

            showTyping();

            try {
                // Send intake data to n8n webhook
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'eXjqAaSiMwinmuYHLzaX83HoNal0iPutGpP855eHjh8'
                    },
                    body: JSON.stringify({
                        name: userData.name,
                        email: userData.email,
                        company: userData.company === 'none' ? null : userData.company,
                        project_type: userData.project_type,
                        budget: userData.budget,
                        timeline: userData.timeline,
                        description: userData.description,
                        integrations: userData.integrations || {},
                        submitted_at: new Date().toISOString(),
                        source: 'start.html'
                    })
                });

                if (!response.ok) {
                    const err = await response.text();
                    throw new Error(err || 'Failed to submit intake');
                }

                hideTyping();
                showSuccess();

            } catch (error) {
                console.error('Submission error:', error);
                hideTyping();
                addMessage(`There was an issue saving your project: ${error.message}. Please email git@sirsote.com directly.`);
            }
        }

        function showSuccess() {
            messagesEl.innerHTML = '';
            inputArea.style.display = 'none';
            progressFill.style.width = '100%';

            const successDiv = document.createElement('div');
            successDiv.className = 'success-screen';
            successDiv.innerHTML = `
                <div class="success-icon">âœ“</div>
                <h2 class="success-title">Project Submitted!</h2>
                <p class="success-message">
                    Thanks, ${userData.name}! I've logged your ${userData.project_type.toLowerCase()} project.<br>
                    SirSote will reach out to <strong>${userData.email}</strong> within 24 hours.
                </p>
                <a href="index.html" class="success-btn">Back to Home</a>
            `;
            messagesEl.appendChild(successDiv);
        }

        // =============================================================================
        // INPUT HANDLING
        // =============================================================================
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
        });

        // =============================================================================
        // MATRIX BACKGROUND
        // =============================================================================
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const chars = '01';
        const charArray = chars.split('');
        const fontSize = 14;
        let columns = canvas.width / fontSize;
        let drops = [];

        for (let i = 0; i < columns; i++) {
            drops[i] = 1;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00ff88';
            ctx.font = fontSize + 'px JetBrains Mono';

            for (let i = 0; i < drops.length; i++) {
                const text = charArray[Math.floor(Math.random() * charArray.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 35);

        // =============================================================================
        // INIT
        // =============================================================================
        window.onload = () => {
            askQuestion();
        };
    </script>
</body>
</html>
